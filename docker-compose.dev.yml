version: '3.8'

services:
  # Backend Dev Service (Go + Air for hot reload)
  litestat-backend-dev:
    container_name: litestat-backend-dev
    image: lgd-litestat-backend:dev
    working_dir: /app
    volumes:
      - ./backend:/app
      - ./data:/app/data
      - ./.env:/app/.env
    ports:
      - "8082:8082"
    environment:
      - DB_PATH=/app/data/analytics.duckdb
      - API_PORT=8082
    # Command is defined in Dockerfile.dev (air)
    # command: ...
    restart: always

  # Frontend Dev Service (Svelte + Vite)
  litestat-frontend-dev:
    container_name: litestat-frontend-dev
    image: lgd-litestat-frontend:dev
    working_dir: /app
    volumes:
      - ./frontend:/app
      # Avoid overwriting node_modules
      - /app/node_modules
    ports:
      - "8081:8081"
    # Command is defined in Dockerfile.dev (npm run dev)
    # command: ...
    environment:
      - VITE_API_URL=http://litestat-backend-dev:8082
    depends_on:
      - litestat-backend-dev

  # Python Scheduler (Data Downloader)
  python-scheduler:
    container_name: litestat-scheduler
    image: lgd-litestat-python:dev
    volumes:
      - ./python-scheduler:/app
      - ./data:/app/data # Share data with backend
      - ./python-scheduler/.env:/app/.env
      - ./backend/config.yaml:/app/config.yaml # Shared Config
    restart: always

networks:
  default:
    driver: bridge
