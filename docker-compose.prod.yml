services:
  # Backend Service (Go + DuckDB)
  litestat-backend:
    container_name: litestat-backend
    image: lgd-litestat-backend:prod
    restart: always
    environment:
      - DB_PATH=/app/data/analytics.duckdb
      - API_PORT=8082
    volumes:
      - ./data:/app/data # Data persistence (Prod partitioning)
      - ./config.yaml:/app/config.yaml # Config file
      - ./.env:/app/.env # Secrets
    # Healthcheck to ensure readiness
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8082/health" ]
      interval: 10s
      timeout: 5s
      retries: 5

  # Frontend Service (Svelte + Nginx)
  litestat-frontend:
    container_name: litestat-frontend
    image: lgd-litestat-frontend:prod
    restart: always
    ports:
      - "8081:80" # Expose on port 8081
    depends_on:
      litestat-backend:
        condition: service_healthy
    networks:
      - default

networks:
  default:
    driver: bridge
